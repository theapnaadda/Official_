<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APNA ADDA</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700;900&display=swap" rel="stylesheet">

    <!-- Firebase SDKs (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary-red: #E50914; 
            --dark-black: #000000;
            --dark-gray: #141414;
            --light-text: #ffffff;
        }

        body {
            background-color: var(--dark-black);
            color: var(--light-text);
            font-family: 'Montserrat', sans-serif;
            overflow-x: hidden;
            padding-bottom: 70px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        @media(min-width: 768px) {
            body { padding-bottom: 0; }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px #E50914; }
            50% { box-shadow: 0 0 20px #E50914, 0 0 10px #ff4d4d; }
            100% { box-shadow: 0 0 5px #E50914; }
        }

        .glow-btn {
            animation: glow 2s infinite;
            background: linear-gradient(45deg, #E50914, #ff4b1f);
        }

        /* Navigation Links */
        .nav-link {
            cursor: pointer;
            padding: 0.5rem 1rem;
            transition: color 0.3s ease;
            color: #aaa;
            font-weight: 500;
            font-size: 0.9rem;
            display: inline-block;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--primary-red);
            font-weight: 700;
        }

        /* Bottom Navigation */
        .bottom-nav-item {
            color: #666;
            transition: all 0.3s ease;
        }
        .bottom-nav-item.active {
            color: var(--primary-red);
        }
        .bottom-nav-item.active i {
            transform: translateY(-2px);
        }

        /* Accordion in Profile */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .accordion-btn.active .fa-chevron-down {
            transform: rotate(180deg);
        }

        /* App Card */
        .app-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background-color: var(--dark-gray);
            border: 1px solid #222;
        }
        .app-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-red);
            box-shadow: 0 5px 20px rgba(229, 9, 20, 0.3);
        }

        /* Slideshow */
        .slide-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            z-index: 0;
        }
        @media (max-width: 768px) {
            .slide-image {
                object-fit: cover;
                background-position: center;
            }
        }
        .slide-image.active {
            opacity: 1;
        }
        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.8) 100%);
            z-index: 1;
            pointer-events: none;
        }

        /* Utility */
        .hidden-section {
            display: none !important;
        }
        
        input, select, textarea {
            background-color: #222;
            border: 1px solid #444;
            color: white;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-red);
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #E50914; border-radius: 4px; }

        /* Login Tabs */
        .auth-tabs {
            display: flex;
            position: relative;
            border-bottom: 2px solid #333;
            margin-bottom: 20px;
        }
        .auth-tab-btn {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            color: #888;
            font-weight: bold;
            transition: color 0.3s;
        }
        .auth-tab-btn.active {
            color: white;
        }
        .auth-glider {
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 50%;
            height: 2px;
            background-color: var(--primary-red);
            transition: transform 0.3s ease-in-out;
            box-shadow: 0 -2px 10px rgba(229, 9, 20, 0.8);
        }

        /* Chat Widget */
        .chat-widget-btn {
            position: fixed;
            bottom: 90px;
            right: 20px;
            background-color: var(--primary-red);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(229, 9, 20, 0.5);
            z-index: 1000;
            transition: transform 0.3s ease;
        }
        .chat-widget-btn:hover { transform: scale(1.1); }
        
        .chat-window {
            position: fixed;
            bottom: 160px;
            right: 20px;
            width: 350px;
            height: 500px;
            background-color: #1a1a1a;
            border: 1px solid #333;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 5px 25px rgba(0,0,0,0.8);
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            transition: all 0.3s ease;
        }
        .chat-window.open {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }
        .chat-header {
            background: var(--primary-red);
            padding: 15px;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chat-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #0f0f0f;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .chat-message {
            max-width: 80%;
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 0.85rem;
            line-height: 1.4;
            word-wrap: break-word;
        }
        .msg-admin {
            align-self: flex-start;
            background-color: #333;
            color: #ddd;
            border-bottom-left-radius: 0;
        }
        .msg-user {
            align-self: flex-end;
            background-color: #E50914;
            color: white;
            border-bottom-right-radius: 0;
        }
        .chat-footer {
            padding: 10px;
            background-color: #1a1a1a;
            border-top: 1px solid #333;
            display: flex;
            gap: 10px;
        }
        .chat-input {
            flex: 1;
            background: #000;
            border: 1px solid #333;
            padding: 8px 12px;
            border-radius: 20px;
            color: white;
            font-size: 0.9rem;
        }
        .chat-send-btn {
            background: transparent;
            color: var(--primary-red);
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
        }
        .notification-dot {
            position: absolute;
            top: 0;
            right: 0;
            width: 15px;
            height: 15px;
            background-color: #fff;
            border: 2px solid var(--primary-red);
            border-radius: 50%;
        }

        /* Notifications & Modal */
        .notif-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .notif-backdrop.open {
            opacity: 1;
            pointer-events: all;
        }
        .notif-box {
            background-color: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            width: 90%;
            max-width: 450px;
            max-height: 80vh; /* Fixed height for scroll */
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            transform: scale(0.9);
            transition: transform 0.3s ease;
            overflow: hidden; /* Hide outer overflow */
            position: relative;
            display: flex;
            flex-direction: column;
        }
        .notif-backdrop.open .notif-box {
            transform: scale(1);
        }
        .notif-header {
            padding: 15px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #222;
        }
        .notif-close {
            cursor: pointer;
            color: #aaa;
            font-size: 1.2rem;
            transition: color 0.3s;
        }
        .notif-close:hover {
            color: white;
        }
        
        /* New Scrollable List Styles */
        #notificationList {
            overflow-y: auto;
            flex: 1;
            padding: 0;
        }
        .notif-item {
            border-bottom: 1px solid #333;
            padding: 20px;
            background: #1a1a1a;
            transition: background 0.2s;
        }
        .notif-item:last-child {
            border-bottom: none;
        }
        .notif-item:hover {
            background: #222;
        }
        .notif-list-img {
            width: 100%;
            height: auto;
            max-height: 250px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #333;
        }
        .notif-text-content {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #ddd;
            white-space: pre-wrap; /* Keeps line breaks */
        }
        .notif-date {
            font-size: 0.75rem;
            color: #666;
            margin-top: 10px;
            text-align: right;
            font-weight: bold;
        }

        /* Nav Dots */
        .nav-notif-btn {
            position: relative;
            cursor: pointer;
            color: #aaa;
            font-size: 1.2rem;
            margin-right: 15px;
            transition: color 0.3s;
        }
        .nav-notif-btn:hover { color: white; }
        .red-dot {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 10px;
            height: 10px;
            background-color: var(--primary-red);
            border-radius: 50%;
            border: 2px solid #000;
            animation: pulse-red 2s infinite;
        }
        @keyframes pulse-red {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(229, 9, 20, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 5px rgba(229, 9, 20, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(229, 9, 20, 0); }
        }

        @media (min-width: 768px) {
            .chat-widget-btn { bottom: 20px; }
            .chat-window { bottom: 90px; }
        }
        @media (max-width: 480px) {
            .chat-window {
                width: 90%;
                right: 5%;
                bottom: 160px;
                height: 50vh;
            }
        }
    </style>
</head>
<body>

    <!-- TOP NAVIGATION -->
    <nav class="w-full bg-black/95 backdrop-blur-sm border-b border-gray-900 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 md:py-4 flex justify-between items-center">
            
            <!-- LOGO -->
            <div class="text-2xl font-black tracking-widest text-red-600 cursor-pointer" onclick="navigateTo('home')">
                APNA ADDA
            </div>

            <!-- DESKTOP MENU -->
            <div id="desktopMenu" class="hidden md:flex items-center gap-6">
                <span class="nav-link active" id="link-home" onclick="navigateTo('home')">Home</span>
                <span class="nav-link" id="link-apps" onclick="navigateTo('apps')">Our Apps</span>
                <span class="nav-link" id="link-about" onclick="navigateTo('about')">About Us</span>
                <span class="nav-link" id="link-contact" onclick="navigateTo('contact')">Contact Us</span>
                
                <div class="h-4 w-px bg-gray-700 mx-2"></div>

                <!-- NOTIFICATION ICON (DESKTOP) -->
                <div class="nav-notif-btn" onclick="openNotificationModal()">
                    <i class="fas fa-bell"></i>
                    <div id="desktopNotifDot" class="red-dot hidden"></div>
                </div>

                <!-- Desktop Auth Buttons -->
                <button id="navLoginBtn" onclick="navigateTo('login')" class="text-white bg-red-600 hover:bg-red-700 px-4 py-1.5 rounded text-sm font-bold transition">Login</button>
                <button id="navDashboardBtn" onclick="navigateTo('admin')" class="hidden text-white bg-gray-800 hover:bg-gray-700 px-4 py-1.5 rounded text-sm transition">Dashboard</button>
                <button id="navLogoutBtn" onclick="handleLogout()" class="hidden text-red-500 hover:text-white px-3 py-1.5 text-sm transition font-bold">Logout</button>
            </div>

            <!-- MOBILE HEADER BUTTONS -->
            <div class="md:hidden flex items-center gap-4">
                <!-- NOTIFICATION ICON (MOBILE) -->
                <div class="nav-notif-btn" onclick="openNotificationModal()" style="font-size: 1.4rem; margin-right: 0;">
                    <i class="fas fa-bell"></i>
                    <div id="mobileNotifDot" class="red-dot hidden"></div>
                </div>

                <button id="mobileHeaderLoginBtn" onclick="navigateTo('login')" class="glow-btn text-white px-4 py-1.5 rounded-full text-xs font-bold tracking-wide shadow-lg hidden">
                    LOGIN <i class="fas fa-sign-in-alt ml-1"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- UPDATED NOTIFICATION MODAL (VERTICAL LIST) -->
    <div id="notificationModal" class="notif-backdrop" onclick="closeNotificationModal(event)">
        <div class="notif-box" onclick="event.stopPropagation()">
            <!-- Modal Header -->
            <div class="notif-header">
                <h3 class="text-white font-bold text-lg"><i class="fas fa-bell text-red-600 mr-2"></i> Notifications</h3>
                <div class="notif-close" onclick="closeNotificationModal(event)"><i class="fas fa-times"></i></div>
            </div>
            
            <!-- Dynamic Scrollable List -->
            <div id="notificationList">
                <!-- Content injected via JS -->
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT AREA -->
    <main class="flex-grow container mx-auto px-4 py-6 md:py-8">

        <!-- 1. HOME SECTION -->
        <div id="section-home" class="animate-fade-in">
            <!-- HERO SECTION -->
            <div class="relative w-full rounded-2xl overflow-hidden mb-8 border border-gray-800 h-[80vh] md:h-[60vh]">
                <div id="heroSlideshow" class="absolute inset-0 w-full h-full bg-gray-900"></div>
                <div class="hero-overlay"></div>
                <div class="relative z-10 flex flex-col items-center justify-center h-full text-center px-4">
                    <h1 class="text-5xl md:text-6xl lg:text-8xl font-black mb-6 md:mb-6 text-white tracking-tighter drop-shadow-2xl">
                        APNA <span class="text-red-600">ADDA</span>
                    </h1>
                    <p class="text-xl md:text-xl lg:text-2xl text-gray-200 font-light tracking-wide max-w-2xl mx-auto mb-10 md:mb-10 drop-shadow-md">
                        Technology for Everyday Growth.
                    </p>
                    <button onclick="scrollToHomeApps()" class="px-8 py-4 md:px-8 md:py-4 bg-red-600/20 backdrop-blur-md border-2 border-red-600 text-white font-bold rounded-full hover:bg-red-600 transition transform hover:scale-105 shadow-lg text-lg md:text-base cursor-pointer pointer-events-auto">
                        EXPLORE APPS
                    </button>
                </div>
            </div>

            <div id="homeAppsContainer" class="py-8 md:py-10 border-t border-gray-900">
                <div class="text-center mb-8 md:mb-10">
                    <h2 class="text-2xl md:text-3xl font-bold border-b-4 border-red-600 inline-block pb-2">Latest Applications</h2>
                </div>
                <!-- OPTIMIZED LOADER -->
                <div id="homeLoader" class="text-center py-10">
                    <i class="fas fa-circle-notch fa-spin text-red-600 text-4xl"></i>
                    <p class="mt-2 text-gray-500">Loading...</p>
                </div>
                <div id="homeAppsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8"></div>
            </div>
        </div>

        <!-- 2. APPS SECTION -->
        <div id="section-apps" class="hidden-section animate-fade-in">
            <div class="text-center mb-8 md:mb-10">
                <h2 class="text-2xl md:text-3xl font-bold border-b-4 border-red-600 inline-block pb-2">All Applications</h2>
            </div>
            <div id="appsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8"></div>
        </div>

        <!-- 3. PROFILE SECTION -->
        <div id="section-profile" class="hidden-section animate-fade-in">
            <div class="max-w-lg mx-auto">
                <div class="bg-gray-900 border border-gray-800 rounded-lg p-6 mb-6 text-center">
                    <div id="profileLoggedOut" class="hidden">
                        <div class="w-20 h-20 bg-gray-800 rounded-full mx-auto flex items-center justify-center mb-4 text-3xl text-gray-600">
                            <i class="fas fa-user"></i>
                        </div>
                        <h2 class="text-xl font-bold text-white mb-2">Welcome Guest</h2>
                        <p class="text-gray-400 text-sm mb-4">Login to access all features.</p>
                        <button onclick="navigateTo('login')" class="glow-btn w-full text-white font-bold py-3 rounded-lg shadow-lg">LOGIN NOW</button>
                    </div>

                    <div id="profileLoggedIn" class="hidden">
                        <div class="w-20 h-20 bg-red-900/30 border-2 border-red-600 rounded-full mx-auto flex items-center justify-center mb-4 text-3xl text-red-500">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <h2 class="text-xl font-bold text-white mb-1" id="profileEmailDisplay">User</h2>
                        <span class="inline-block bg-gray-800 text-xs px-2 py-1 rounded text-gray-400 mb-4">Member</span>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <button id="profileAdminBtn" onclick="navigateTo('admin')" class="hidden w-full bg-gray-800 hover:bg-gray-700 text-white font-bold py-2 rounded text-sm border border-gray-700">
                                DASHBOARD
                            </button>
                            <button onclick="handleLogout()" class="w-full bg-red-900/20 hover:bg-red-900/40 text-red-500 font-bold py-2 rounded text-sm border border-red-900/50">
                                LOGOUT
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Accordions -->
                <div class="space-y-3">
                    <div class="bg-gray-900 border border-gray-800 rounded-lg overflow-hidden">
                        <button class="accordion-btn w-full flex justify-between items-center p-4 text-left font-bold text-gray-300 hover:bg-gray-800 transition" onclick="toggleAccordion('acc-about', this)">
                            <span><i class="fas fa-info-circle w-6 text-center text-red-600 mr-2"></i> About Us</span>
                            <i class="fas fa-chevron-down transition-transform duration-300"></i>
                        </button>
                        <div id="acc-about" class="accordion-content bg-black">
                            <div class="p-4 text-sm text-gray-400 leading-relaxed text-justify space-y-3">
                                <p>APNA ADDA is a technology-driven company committed to building smart, simple, and useful digital solutions for everyday life. We primarily focus on creating applications that support students, while also offering tools that benefit people from all walks of life.</p>
                                <p>The company was founded and is owned by Premanshu Kumar.</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-900 border border-gray-800 rounded-lg overflow-hidden">
                        <button class="accordion-btn w-full flex justify-between items-center p-4 text-left font-bold text-gray-300 hover:bg-gray-800 transition" onclick="toggleAccordion('acc-contact', this)">
                            <span><i class="fas fa-envelope w-6 text-center text-blue-500 mr-2"></i> Contact Us</span>
                            <i class="fas fa-chevron-down transition-transform duration-300"></i>
                        </button>
                        <div id="acc-contact" class="accordion-content bg-black">
                            <div class="p-4 flex flex-col gap-3">
                                <a href="mailto:thepremanshu@gmail.com" class="flex items-center gap-3 text-gray-400 hover:text-white"><i class="fas fa-at text-red-500"></i> Email Us</a>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-900 border border-gray-800 rounded-lg overflow-hidden">
                        <button class="accordion-btn w-full flex justify-between items-center p-4 text-left font-bold text-gray-300 hover:bg-gray-800 transition" onclick="toggleAccordion('acc-privacy', this)">
                            <span><i class="fas fa-shield-alt w-6 text-center text-green-500 mr-2"></i> Privacy Policy</span>
                            <i class="fas fa-chevron-down transition-transform duration-300"></i>
                        </button>
                        <div id="acc-privacy" class="accordion-content bg-black">
                            <div class="p-4 text-sm text-gray-400">
                                <p>Your privacy is important to APNA ADDA. We respect your personal information and use it only to improve our services.</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-900 border border-gray-800 rounded-lg overflow-hidden">
                        <button class="accordion-btn w-full flex justify-between items-center p-4 text-left font-bold text-gray-300 hover:bg-gray-800 transition" onclick="toggleAccordion('acc-disclaimer', this)">
                            <span><i class="fas fa-exclamation-triangle w-6 text-center text-yellow-500 mr-2"></i> Disclaimer</span>
                            <i class="fas fa-chevron-down transition-transform duration-300"></i>
                        </button>
                        <div id="acc-disclaimer" class="accordion-content bg-black">
                            <div class="p-4 text-sm text-gray-400">
                                <p>Information provided on APNA ADDA is for general informational purposes only. Use at your own risk.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. ABOUT SECTION (Desktop) -->
        <div id="section-about" class="hidden-section hidden md:block">
             <div class="max-w-4xl mx-auto bg-gray-900 border border-gray-800 rounded-lg p-12 shadow-2xl">
                <h2 class="text-3xl font-bold mb-6 text-red-600">About APNA ADDA</h2>
                <div class="space-y-4 text-gray-300 leading-relaxed text-justify">
                    <p>APNA ADDA is a technology-driven company committed to building smart, simple, and useful digital solutions for everyday life.</p>
                    <p>The company was founded and is owned by <strong>Premanshu Kumar</strong>.</p>
                </div>
            </div>
        </div>

        <!-- 5. CONTACT SECTION (Desktop) -->
        <div id="section-contact" class="hidden-section hidden md:block">
             <div class="flex flex-col items-center justify-center min-h-[50vh]">
                <h2 class="text-4xl font-bold mb-8">Get In Touch</h2>
                <div class="bg-gray-900 p-8 rounded-xl border border-gray-800 shadow-lg w-full max-w-lg text-center">
                    <a href="mailto:thepremanshu@gmail.com" class="flex items-center justify-center gap-3 w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded shadow transition">
                        <i class="fas fa-envelope"></i> Email Us
                    </a>
                </div>
            </div>
        </div>

        <!-- 6. PRIVACY & DISCLAIMER (Desktop) -->
        <div id="section-privacy" class="hidden-section hidden md:block">
            <div class="max-w-4xl mx-auto bg-gray-900 border border-gray-800 rounded-lg p-12 shadow-2xl">
                <h2 class="text-3xl font-bold mb-6 text-green-500">Privacy Policy</h2>
                <div class="space-y-4 text-gray-300"><p>Your privacy is important to APNA ADDA. We do not sell your data.</p></div>
            </div>
        </div>
        <div id="section-disclaimer" class="hidden-section hidden md:block">
            <div class="max-w-4xl mx-auto bg-gray-900 border border-gray-800 rounded-lg p-12 shadow-2xl">
                <h2 class="text-3xl font-bold mb-6 text-yellow-500">Disclaimer</h2>
                <div class="space-y-4 text-gray-300"><p>Use our applications at your own discretion. Information is for general purposes.</p></div>
            </div>
        </div>

        <!-- 8. LOGIN / SIGNUP SECTION -->
        <div id="section-login" class="hidden-section flex justify-center items-center h-full py-10">
            <div class="bg-gray-900 p-8 rounded-lg border border-red-900/30 shadow-2xl w-full max-w-md animate-fade-in mx-2">
                <button onclick="handleGoogleLogin()" class="w-full bg-white text-black font-bold py-3 rounded hover:bg-gray-200 transition flex items-center justify-center gap-3 mb-6">
                    <i class="fab fa-google text-red-600 text-lg"></i> Continue with Google
                </button>

                <div class="auth-tabs">
                    <div class="auth-tab-btn active" id="tab-login" onclick="switchAuthTab('login')">LOGIN</div>
                    <div class="auth-tab-btn" id="tab-signup" onclick="switchAuthTab('signup')">SIGNUP</div>
                    <div class="auth-glider" id="authGlider"></div>
                </div>

                <form id="loginForm" onsubmit="handleLoginSubmit(event)" class="auth-form-block">
                    <h3 class="text-white font-bold mb-4 text-xl">Welcome Back</h3>
                    <div class="mb-4"><label class="block text-gray-400 mb-2 text-sm">Email</label><input type="email" id="loginEmail" class="w-full p-3 rounded bg-black border-gray-700 focus:border-red-600 transition" required></div>
                    <div class="mb-6"><label class="block text-gray-400 mb-2 text-sm">Password</label><input type="password" id="loginPass" class="w-full p-3 rounded bg-black border-gray-700 focus:border-red-600 transition" required></div>
                    <button type="submit" id="loginBtn" class="w-full bg-red-600 text-white font-bold py-3 rounded hover:bg-red-700 transition">LOGIN</button>
                </form>

                <form id="signupForm" onsubmit="handleSignupSubmit(event)" class="auth-form-block hidden">
                    <h3 class="text-white font-bold mb-4 text-xl">Create Account</h3>
                    <div class="mb-4"><label class="block text-gray-400 mb-2 text-sm">Email</label><input type="email" id="signupEmail" class="w-full p-3 rounded bg-black border-gray-700 focus:border-red-600 transition" required></div>
                    <div class="mb-6"><label class="block text-gray-400 mb-2 text-sm">Set Password</label><input type="password" id="signupPass" class="w-full p-3 rounded bg-black border-gray-700 focus:border-red-600 transition" required></div>
                    <button type="submit" id="signupBtn" class="w-full bg-white text-black font-bold py-3 rounded hover:bg-gray-200 transition">SIGN UP</button>
                </form>

            </div>
        </div>

        <!-- 9. ADMIN DASHBOARD -->
        <div id="section-admin" class="hidden-section">
            <div class="flex justify-between items-center mb-8 border-b border-gray-800 pb-4">
                <h2 class="text-xl md:text-2xl font-bold text-white">Admin Dashboard</h2>
            </div>
            <!-- Admin Content -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                 <!-- 1. Add/Edit App Form (Col 1-3) -->
                 <div class="lg:col-span-3 bg-gray-900 p-6 rounded-lg border border-gray-800 h-fit">
                    <h3 class="text-lg font-bold text-white mb-4">Add / Edit App</h3>
                    <form id="appForm" onsubmit="handleAppSubmit(event)">
                        <input type="hidden" id="editAppId">
                        
                        <div class="mb-3">
                            <label class="text-xs text-gray-400 block mb-1">Name</label>
                            <input type="text" id="appName" class="w-full p-2 rounded" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="text-xs text-gray-400 block mb-1">Status Type</label>
                            <select id="launchStatus" class="w-full p-2 rounded" onchange="toggleStatusFields()" required>
                                <option value="Launched">Launched</option>
                                <option value="Coming Soon">Coming Soon (General)</option>
                                <option value="come_tomorrow">Come Tomorrow</option>
                                <option value="delay">Delay in Launch</option>
                                <option value="date">Specific Date</option>
                                <option value="weeks">In X Weeks</option>
                                <option value="months">In X Months</option>
                                <option value="hours">In X Hours (Countdown)</option>
                                <option value="countdown">Live Countdown (Min:Sec)</option>
                                <option value="relaunch_date">RELAUNCH SPECIFIC DATE</option>
                                <option value="relaunch_weeks">RELAUNCH SPECIFIC WEEK</option>
                                <option value="relaunch_hours">RELAUNCH IN X HOURS (RUNNING)</option>
                                <option value="relaunch_countdown">RELAUNCH COUNTDOWN</option>
                                <option value="error">ERROR IN WEBSITE</option>
                                <option value="emergency">EMERGENCY LAUNCH</option>
                                <option value="none">No Status Badge</option>
                            </select>
                        </div>

                        <!-- Dynamic Inputs -->
                        <div id="dateField" class="mb-3 hidden">
                            <label class="text-xs text-gray-400 block mb-1">Select Date</label>
                            <input type="date" id="statusDate" class="w-full p-2 rounded">
                        </div>
                        <div id="weeksField" class="mb-3 hidden">
                            <label class="text-xs text-gray-400 block mb-1">Number of Weeks</label>
                            <input type="number" id="statusWeeks" class="w-full p-2 rounded" placeholder="e.g. 2">
                        </div>
                        <div id="monthsField" class="mb-3 hidden">
                            <label class="text-xs text-gray-400 block mb-1">Number of Months</label>
                            <input type="number" id="statusMonths" class="w-full p-2 rounded" placeholder="e.g. 6">
                        </div>
                        <div id="hoursField" class="mb-3 hidden">
                            <label class="text-xs text-gray-400 block mb-1">Number of Hours</label>
                            <input type="number" id="statusHours" class="w-full p-2 rounded" placeholder="e.g. 17">
                        </div>
                        <div id="countdownField" class="mb-3 hidden">
                            <div class="p-2 bg-gray-800 rounded border border-gray-700 mb-2">
                                <label class="text-xs text-gray-400 block mb-1">Target Launch Time</label>
                                <input type="datetime-local" id="statusCountdown" class="w-full p-2 rounded text-black mb-2">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="text-xs text-gray-400 block mb-1">Link (Launch URL)</label>
                            <input type="url" id="appLink" class="w-full p-2 rounded" placeholder="https://...">
                        </div>
                        
                        <div class="mb-4"><label class="text-xs text-gray-400 block mb-1">Image (Auto-Resized)</label><input type="file" id="appImage" class="w-full text-xs text-gray-400" accept="image/*"></div>
                        <div class="flex gap-2">
                            <button type="submit" id="submitBtn" class="flex-1 bg-white text-black font-bold py-2 rounded hover:bg-gray-200">Save</button>
                            <button type="button" onclick="resetForm()" class="px-3 border border-gray-600 rounded text-white">Reset</button>
                        </div>
                    </form>
                </div>

                <!-- 2. Slideshow (Col 4-6) -->
                <div class="lg:col-span-3 bg-gray-900 p-6 rounded-lg border border-gray-800 h-fit">
                    <h3 class="text-lg font-bold text-white mb-4">Slideshow</h3>
                    <div class="mb-4">
                        <input type="file" id="slideUploadInput" class="w-full text-xs text-gray-400 mb-2" accept="image/*">
                        <button onclick="uploadSlide()" id="slideUploadBtn" class="w-full bg-red-600 text-white font-bold py-2 rounded hover:bg-red-700 text-sm">Upload</button>
                    </div>
                    <div id="adminSlidesList" class="space-y-2 max-h-60 overflow-y-auto"></div>
                </div>

                <!-- 3. App List (Col 7-12) -->
                <div class="lg:col-span-6 bg-gray-900 rounded-lg border border-gray-800 overflow-hidden h-fit mb-6">
                    <div class="p-4 bg-black border-b border-gray-800"><h3 class="font-bold">App Database</h3></div>
                    <div class="overflow-x-auto max-h-80 overflow-y-auto">
                        <table class="w-full text-left text-sm text-gray-400 whitespace-nowrap">
                            <thead class="bg-gray-800 text-xs uppercase"><tr><th class="p-3">Name</th><th class="p-3">Status</th><th class="p-3 text-right">Action</th></tr></thead>
                            <tbody id="adminAppsTable"></tbody>
                        </table>
                    </div>
                </div>

                <!-- 4. Notification Center (UPDATED: SEND + HISTORY) -->
                <div class="lg:col-span-6 bg-gray-900 p-6 rounded-lg border border-gray-800 h-fit">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-white"><i class="fas fa-bell text-red-600 mr-2"></i> Notification Center</h3>
                    </div>
                    
                    <!-- Send/Edit Form -->
                    <form onsubmit="handleNotificationSubmit(event)" class="space-y-4 mb-6 border-b border-gray-800 pb-6">
                        <input type="hidden" id="editNotifId">
                        <div>
                            <label class="text-xs text-gray-400 block mb-1">Notification Text</label>
                            <textarea id="notifText" class="w-full p-2 rounded h-20" placeholder="Type message..."></textarea>
                        </div>
                        <div>
                            <label class="text-xs text-gray-400 block mb-1">Image (Optional, Any Size)</label>
                            <input type="file" id="notifImage" class="w-full text-xs text-gray-400" accept="image/*">
                        </div>
                        <div class="flex gap-2">
                            <button type="submit" id="notifSubmitBtn" class="flex-1 bg-white text-black font-bold py-2 rounded hover:bg-gray-200 text-sm">SEND</button>
                            <button type="button" onclick="resetNotifForm()" class="px-3 border border-gray-600 rounded text-white text-sm">Reset</button>
                        </div>
                        <p class="text-[10px] text-gray-500">Will trigger a red dot. Users see list sorted by date.</p>
                    </form>

                    <!-- History List -->
                    <h4 class="text-sm font-bold text-gray-300 mb-2">Sent Notifications</h4>
                    <div class="overflow-x-auto max-h-60 overflow-y-auto border border-gray-800 rounded">
                        <table class="w-full text-left text-xs text-gray-400">
                            <thead class="bg-gray-800"><tr><th class="p-2">Message</th><th class="p-2 text-right">Action</th></tr></thead>
                            <tbody id="adminNotifTable"></tbody>
                        </table>
                    </div>
                </div>

                <!-- 5. Support (Full) -->
                <div class="lg:col-span-12 bg-gray-900 rounded-lg border border-gray-800 overflow-hidden mt-2">
                    <div class="p-4 bg-black border-b border-gray-800 flex justify-between">
                        <h3 class="font-bold text-white">Support Messages</h3>
                        <button onclick="fetchSupportChats()" class="text-xs text-gray-400 hover:text-white"><i class="fas fa-sync"></i> Refresh</button>
                    </div>
                    <div class="flex flex-col md:flex-row h-[400px]">
                        <div class="w-full md:w-1/3 border-r border-gray-800 overflow-y-auto bg-[#111]" id="adminSupportUserList"></div>
                        <div class="w-full md:w-2/3 flex flex-col bg-[#0a0a0a] relative">
                            <div id="adminChatHeader" class="p-3 border-b border-gray-800 bg-[#141414] font-bold text-gray-300 flex justify-between items-center">
                                <span>Select user</span>
                            </div>
                            <div id="adminChatBody" class="flex-1 overflow-y-auto p-4 flex flex-col gap-3"></div>
                            <div id="adminChatFooter" class="p-3 border-t border-gray-800 bg-[#141414] hidden">
                                <form onsubmit="sendAdminReply(event)" class="flex gap-2">
                                    <input type="text" id="adminChatInput" class="flex-1 bg-black border border-gray-700 rounded-full px-4 py-2 text-sm" placeholder="Reply...">
                                    <button type="submit" class="text-red-600 px-3"><i class="fas fa-paper-plane"></i></button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- DESKTOP FOOTER -->
    <footer class="hidden md:block bg-black border-t border-gray-900 py-8 mt-auto">
        <div class="container mx-auto px-4 text-center">
            <div class="flex justify-center gap-8 mb-4 text-sm font-medium text-gray-400">
                <span onclick="navigateTo('privacy')" class="cursor-pointer hover:text-red-500 transition">Privacy Policy</span>
                <span onclick="navigateTo('disclaimer')" class="cursor-pointer hover:text-red-500 transition">Disclaimer</span>
                <span onclick="navigateTo('about')" class="cursor-pointer hover:text-red-500 transition">About Us</span>
                <span onclick="navigateTo('contact')" class="cursor-pointer hover:text-red-500 transition">Contact Us</span>
            </div>
            <div class="w-24 h-px bg-gray-800 mx-auto mb-4"></div>
            <p class="text-xs text-gray-600 tracking-widest font-bold">DESIGNED BY PREMANSHU KUMAR</p>
        </div>
    </footer>

    <!-- MOBILE BOTTOM NAVIGATION -->
    <div class="md:hidden fixed bottom-0 left-0 w-full bg-black/95 backdrop-blur-md border-t border-gray-900 flex justify-around items-center py-3 z-40 pb-safe">
        <div class="bottom-nav-item active flex flex-col items-center gap-1 cursor-pointer w-1/3" id="bn-home" onclick="navigateTo('home')">
            <i class="fas fa-home text-xl"></i>
            <span class="text-[10px] font-bold">Home</span>
        </div>
        <div class="bottom-nav-item flex flex-col items-center gap-1 cursor-pointer w-1/3" id="bn-apps" onclick="navigateTo('apps')">
            <i class="fas fa-th-large text-xl"></i>
            <span class="text-[10px] font-bold">Apps</span>
        </div>
        <div class="bottom-nav-item flex flex-col items-center gap-1 cursor-pointer w-1/3" id="bn-profile" onclick="navigateTo('profile')">
            <i class="fas fa-user-circle text-xl"></i>
            <span class="text-[10px] font-bold">Profile</span>
        </div>
    </div>

    <!-- SUPPORT CHAT WIDGET -->
    <div id="supportWidget" class="z-50">
        <div class="chat-widget-btn" onclick="toggleChatWindow()">
            <i class="fas fa-comments"></i>
            <div id="userChatBadge" class="notification-dot hidden"></div>
        </div>
        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <div class="flex items-center gap-2"><i class="fas fa-robot"></i> SUPPORT</div>
                <i class="fas fa-times cursor-pointer" onclick="toggleChatWindow()"></i>
            </div>
            <div class="bg-gray-800 p-3 text-xs text-center text-gray-400 border-b border-gray-700">
                WELCOME TO APNA ADDA! HOW CAN WE ASSIST YOU TODAY?
            </div>
            <div class="chat-body" id="userChatBody"></div>
            <div class="chat-footer">
                <form class="flex w-full gap-2" onsubmit="sendUserMessage(event)">
                    <input type="text" id="userChatInput" class="chat-input" placeholder="Type message..." required autocomplete="off">
                    <button type="submit" class="chat-send-btn"><i class="fas fa-paper-plane"></i></button>
                </form>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        // 1. FIREBASE CONFIG
        const firebaseConfig = {
          apiKey: "AIzaSyBVAGHlCxVKRQPx34823j0O8UNEEqJqTpE",
          authDomain: "official-website-56eaf.firebaseapp.com",
          databaseURL: "https://official-website-56eaf-default-rtdb.firebaseio.com",
          projectId: "official-website-56eaf",
          storageBucket: "official-website-56eaf.firebasestorage.app",
          messagingSenderId: "1031308197634",
          appId: "1:1031308197634:web:7eb301b19df54da0724c1b"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

        // 2. STATE
        const ADMIN_EMAIL = "thepremanshu@gmail.com";
        let allApps = [];
        let allSlides = [];
        let allNotifications = [];
        let slideInterval = null;
        let countdownInterval = null;
        let currentUserEmail = null;
        let currentAdminChatUser = null;
        const sections = ['home', 'apps', 'about', 'contact', 'login', 'admin', 'profile', 'privacy', 'disclaimer'];

        // 3. INIT & NAVIGATION
        window.onload = function() {
            const savedSection = localStorage.getItem('apnaAddaCurrentSection') || 'home';
            if(savedSection !== 'admin') navigateTo(savedSection, true); 
            fetchApps();
            fetchSlides();
            initNotifications(); 
        };

        function navigateTo(sectionId, isInitialLoad = false) {
            if(!isInitialLoad) localStorage.setItem('apnaAddaCurrentSection', sectionId);
            sections.forEach(s => { const el = document.getElementById(`section-${s}`); if(el) el.classList.add('hidden-section'); });
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            const navLink = document.getElementById(`link-${sectionId}`); if (navLink) navLink.classList.add('active');
            document.querySelectorAll('.bottom-nav-item').forEach(i => i.classList.remove('active'));
            if(sectionId === 'home') document.getElementById('bn-home').classList.add('active');
            else if(sectionId === 'apps') document.getElementById('bn-apps').classList.add('active');
            else if(['profile', 'login', 'admin', 'about', 'contact', 'privacy', 'disclaimer'].includes(sectionId)) document.getElementById('bn-profile').classList.add('active');

            if(window.innerWidth < 768 && ['about', 'contact', 'privacy', 'disclaimer'].includes(sectionId)) {
                document.getElementById('section-profile').classList.remove('hidden-section');
                document.querySelectorAll('.accordion-content').forEach(c => { c.style.maxHeight = '0'; });
                document.querySelectorAll('.accordion-btn').forEach(b => { b.classList.remove('active'); });
                const accBtn = document.querySelector(`button[onclick="toggleAccordion('acc-${sectionId}', this)"]`);
                const accContent = document.getElementById(`acc-${sectionId}`);
                if(accBtn && accContent) { accBtn.classList.add('active'); accContent.style.maxHeight = accContent.scrollHeight + "px"; }
            } else {
                const target = document.getElementById(`section-${sectionId}`); if(target) target.classList.remove('hidden-section');
            }
            window.scrollTo(0, 0);
        }

        function scrollToHomeApps() { document.getElementById('homeAppsContainer').scrollIntoView({ behavior: 'smooth' }); }
        function toggleAccordion(id, btn) {
            const content = document.getElementById(id); const isActive = btn.classList.contains('active');
            document.querySelectorAll('.accordion-content').forEach(c => { c.style.maxHeight = '0'; });
            document.querySelectorAll('.accordion-btn').forEach(b => { b.classList.remove('active'); });
            if (!isActive) { btn.classList.add('active'); content.style.maxHeight = content.scrollHeight + "px"; }
        }

        // --- IMAGE COMPRESSOR ---
        const compressAndConvertToBase64 = async (file) => {
            if (file.size < 1024 * 1024) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = (e) => reject(e);
                    reader.readAsDataURL(file);
                });
            }
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        const MAX_DIMENSION = 1280; 
                        if (width > height) {
                            if (width > MAX_DIMENSION) {
                                height *= MAX_DIMENSION / width;
                                width = MAX_DIMENSION;
                            }
                        } else {
                            if (height > MAX_DIMENSION) {
                                width *= MAX_DIMENSION / height;
                                height = MAX_DIMENSION;
                            }
                        }
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        let quality = 0.9;
                        let base64 = canvas.toDataURL('image/jpeg', quality);
                        while (base64.length * 0.75 > 900 * 1024 && quality > 0.1) {
                            quality -= 0.1;
                            base64 = canvas.toDataURL('image/jpeg', quality);
                        }
                        resolve(base64);
                    };
                    img.onerror = (err) => reject(err);
                };
                reader.onerror = (err) => reject(err);
            });
        };

        // ============================================
        // APP LOGIC
        // ============================================
        function fetchApps() { 
            const loader = document.getElementById('homeLoader');
            if(loader) loader.style.display = 'block';

            setTimeout(() => {
                if(loader && loader.style.display === 'block') {
                   loader.innerHTML = '<p class="text-gray-500 text-sm">Request Timed Out. Please Refresh.</p>';
                }
            }, 10000);

            db.ref('apps').on('value', (snapshot) => { 
                allApps=[]; 
                const d = snapshot.val(); 
                if(d) Object.keys(d).forEach(k=>allApps.push({id:k,...d[k]})); 
                renderPublicGrid(); 
                renderAdminTable(); 
                if(loader) loader.style.display = 'none';
            }, (error) => {
                console.error("Firebase Error:", error);
                if(loader) loader.style.display = 'none';
            }); 
        }

        function renderPublicGrid() {
            const g1 = document.getElementById('homeAppsGrid'); const g2 = document.getElementById('appsGrid');
            const loader = document.getElementById('homeLoader');
            if(loader) loader.style.display = 'none';

            g1.innerHTML = ''; g2.innerHTML = '';
            if(countdownInterval) clearInterval(countdownInterval);

            if(allApps.length === 0) {
                g1.innerHTML = '<p class="col-span-3 text-center text-gray-500">No apps found.</p>';
            }

            allApps.forEach(a => {
                let badgeColor = 'bg-gray-600'; let badgeText = ''; let btnText = 'WAIT'; let btnClass = 'bg-gray-800 text-gray-500 action-btn'; let link = '#'; let isClickable = false;
                if (a.status === 'Launched') { badgeColor = 'bg-green-600'; badgeText = 'LAUNCHED'; btnText = 'OPEN'; btnClass = 'bg-red-600 text-white action-btn'; link = a.link; isClickable = true; } 
                else if (a.status === 'Coming Soon') { badgeColor = 'bg-blue-600'; badgeText = 'COMING SOON'; } 
                else if (a.status === 'come_tomorrow') { badgeColor = 'bg-blue-500'; badgeText = 'COME TOMORROW'; } 
                else if (a.status === 'delay') { badgeColor = 'bg-yellow-600'; badgeText = 'DELAY IN LAUNCH'; } 
                else if (a.status === 'date') { badgeColor = 'bg-blue-600'; badgeText = `COMING ON: ${a.statusDetail}`; } 
                else if (a.status === 'weeks') { badgeColor = 'bg-purple-600'; badgeText = `COMING IN ${a.statusDetail} WEEKS`; } 
                else if (a.status === 'months') { badgeColor = 'bg-indigo-600'; badgeText = `COMING IN ${a.statusDetail} MONTHS`; } 
                else if (a.status === 'hours') { badgeColor = 'bg-orange-500 animate-pulse badge-container'; badgeText = `LIVE: <span class="countdown-timer" data-target="${a.statusDetail}" data-link="${a.link || '#'}" data-id="${a.id}" data-type="${a.status}">...</span>`; } 
                else if (a.status === 'countdown') { badgeColor = 'bg-red-600 animate-pulse badge-container'; badgeText = `LIVE: <span class="countdown-timer" data-target="${a.statusDetail}" data-link="${a.link || '#'}" data-id="${a.id}" data-type="${a.status}">...</span>`; } 
                else if (a.status === 'relaunch_date') { badgeColor = 'bg-pink-700'; badgeText = `RELAUNCH: ${a.statusDetail}`; }
                else if (a.status === 'relaunch_weeks') { badgeColor = 'bg-pink-700'; badgeText = `RELAUNCH IN ${a.statusDetail} WEEKS`; }
                else if (a.status === 'relaunch_hours') { badgeColor = 'bg-pink-600 animate-pulse badge-container'; badgeText = `RELAUNCH: <span class="countdown-timer" data-target="${a.statusDetail}" data-link="${a.link || '#'}" data-id="${a.id}" data-type="${a.status}">...</span>`; }
                else if (a.status === 'relaunch_countdown') { badgeColor = 'bg-pink-600 animate-pulse badge-container'; badgeText = `RELAUNCH: <span class="countdown-timer" data-target="${a.statusDetail}" data-link="${a.link || '#'}" data-id="${a.id}" data-type="${a.status}">...</span>`; }
                else if (a.status === 'error') { badgeColor = 'bg-red-800'; badgeText = 'WEBSITE ERROR'; btnText = 'WAIT FOR RELAUNCH'; btnClass = 'bg-red-600 text-white action-btn'; link = '#'; isClickable = false; }
                else if (a.status === 'emergency') { badgeColor = 'bg-red-600 animate-pulse border-2 border-yellow-400'; badgeText = 'EMERGENCY LAUNCH'; btnText = 'OPEN'; btnClass = 'bg-red-600 text-white action-btn'; link = a.link; isClickable = true; }
                else if (a.status === 'none') { badgeText = ''; }

                const html = `<div class="app-card rounded-lg overflow-hidden flex flex-col h-full relative" id="card-${a.id}"><div class="relative w-full h-48 bg-gray-900 border-b border-gray-800">${a.image ? `<img src="${a.image}" class="w-full h-full object-fill" alt="${a.name}">` : `<div class="w-full h-full flex items-center justify-center text-red-600 font-bold text-2xl">ADDA</div>`}${badgeText ? `<span class="absolute top-2 right-2 ${badgeColor} text-white text-[10px] font-black tracking-wider px-2 py-1 rounded shadow-md border border-white/20 badge-text">${badgeText}</span>` : ''}</div><div class="p-4 bg-gray-900 flex flex-col flex-grow"><h3 class="font-bold text-white mb-4 text-lg line-clamp-1">${a.name}</h3><a href="${link}" target="_blank" ${!isClickable ? 'onclick="return false;"' : ''} class="mt-auto block text-center ${btnClass} font-bold py-2 rounded text-sm transition hover:scale-105">${btnText}</a></div></div>`;
                g1.innerHTML += html; g2.innerHTML += html;
            });
            startCountdownTimers();
        }

        function startCountdownTimers() {
            const updateTimers = () => {
                const timers = document.querySelectorAll('.countdown-timer');
                timers.forEach(timer => {
                    const targetStr = timer.getAttribute('data-target'); const launchLink = timer.getAttribute('data-link'); const appId = timer.getAttribute('data-id'); const statusType = timer.getAttribute('data-type');
                    if (!targetStr) return;
                    const distance = new Date(targetStr).getTime() - new Date().getTime();
                    if (distance < 0) {
                        const isRelaunch = statusType.includes('relaunch'); timer.innerHTML = isRelaunch ? "RELAUNCHED" : "LAUNCHED";
                        const badgeContainer = timer.closest('.badge-container'); if (badgeContainer) { badgeContainer.classList.remove('bg-red-600', 'bg-orange-500', 'bg-pink-600', 'animate-pulse'); badgeContainer.classList.add('bg-green-600'); badgeContainer.innerHTML = isRelaunch ? "RELAUNCHED" : "LAUNCHED"; }
                        document.querySelectorAll(`#card-${appId}`).forEach(card => { const btn = card.querySelector('.action-btn'); if (btn && btn.innerText !== 'OPEN') { btn.innerText = "OPEN"; btn.classList.remove('bg-gray-800', 'text-gray-500'); btn.classList.add('bg-red-600', 'text-white'); btn.href = launchLink; btn.setAttribute('target', '_blank'); btn.onclick = null; } });
                        return;
                    }
                    const days = Math.floor(distance / (1000 * 60 * 60 * 24)); const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)); const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)); const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                    let display = `${minutes}m ${seconds}s`; if (hours > 0) display = `${hours}h ${display}`; if (days > 0) display = `${days}d ${display}`; timer.innerHTML = display;
                });
            };
            updateTimers(); countdownInterval = setInterval(updateTimers, 1000);
        }

        async function handleAppSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('editAppId').value;
            const f = document.getElementById('appImage').files[0];
            const btn = document.getElementById('submitBtn');
            const originalText = btn.innerText;
            let imageBase64 = '';
            if (f) {
                btn.innerText = "Compressing...";
                try { imageBase64 = await compressAndConvertToBase64(f); } catch(err) { showToast('Error processing image', 'error'); btn.innerText = originalText; return; }
            } else if (id) {
                const o = allApps.find(x => x.id === id); 
                if (o) imageBase64 = o.image;
            }
            const statusType = document.getElementById('launchStatus').value;
            let detail = '';
            if (statusType.includes('date')) detail = document.getElementById('statusDate').value;
            else if (statusType.includes('weeks')) detail = document.getElementById('statusWeeks').value;
            else if (statusType.includes('months')) detail = document.getElementById('statusMonths').value;
            else if (statusType.includes('hours')) { const h = parseFloat(document.getElementById('statusHours').value); if (!isNaN(h)) { detail = new Date(Date.now() + h * 60 * 60 * 1000).toISOString(); } }
            else if (statusType.includes('countdown')) detail = document.getElementById('statusCountdown').value;

            const p = { name: document.getElementById('appName').value, status: statusType, statusDetail: detail, link: document.getElementById('appLink').value, image: imageBase64 || '' };
            btn.innerText = "SAVING...";
            const promise = id ? db.ref('apps/' + id).update(p) : db.ref('apps').push(p);
            promise.then(() => { showToast(id ? 'App updated!' : 'App added!', 'success'); resetForm(); }).catch((error) => { Swal.fire({ icon: 'error', title: 'Save Failed', text: error.message, background: '#1a1a1a', color: '#fff' }); }).finally(() => { btn.innerText = originalText; });
        }
        
        function toggleStatusFields() {
            const v = document.getElementById('launchStatus').value;
            ['dateField', 'weeksField', 'monthsField', 'hoursField', 'countdownField'].forEach(id => document.getElementById(id).classList.add('hidden'));
            if (v.includes('date')) document.getElementById('dateField').classList.remove('hidden');
            if (v.includes('weeks')) document.getElementById('weeksField').classList.remove('hidden');
            if (v.includes('months')) document.getElementById('monthsField').classList.remove('hidden');
            if (v.includes('hours')) document.getElementById('hoursField').classList.remove('hidden');
            if (v.includes('countdown')) document.getElementById('countdownField').classList.remove('hidden');
        }
        function deleteApp(id) { showConfirm('Delete App?', 'Permanently remove app?').then((result) => { if (result.isConfirmed) { db.ref('apps/' + id).remove(); showToast('App deleted.', 'info'); } }); }
        function editApp(id) { const a = allApps.find(x => x.id === id); if (!a) return; document.getElementById('editAppId').value = a.id; document.getElementById('appName').value = a.name; document.getElementById('launchStatus').value = a.status; document.getElementById('appLink').value = a.link || ''; toggleStatusFields(); if (a.status.includes('date')) document.getElementById('statusDate').value = a.statusDetail; if (a.status.includes('weeks')) document.getElementById('statusWeeks').value = a.statusDetail; if (a.status.includes('months')) document.getElementById('statusMonths').value = a.statusDetail; if (a.status.includes('hours')) { const remainingHours = (new Date(a.statusDetail).getTime() - new Date().getTime()) / (1000 * 60 * 60); document.getElementById('statusHours').value = remainingHours > 0 ? remainingHours.toFixed(2) : 0; } if (a.status.includes('countdown')) document.getElementById('statusCountdown').value = a.statusDetail; showToast('Editing: ' + a.name, 'info'); }
        function resetForm(){ document.getElementById('appForm').reset(); document.getElementById('editAppId').value=''; toggleStatusFields(); }

        // --- SLIDESHOW LOGIC ---
        function fetchSlides() { db.ref('slides').on('value', s => { allSlides=[]; const d=s.val(); if(d)Object.keys(d).forEach(k=>allSlides.push({id:k,image:d[k].image})); const c=document.getElementById('heroSlideshow'); c.innerHTML=''; const l=document.getElementById('adminSlidesList'); l.innerHTML=''; allSlides.forEach((x,i)=>{ const m=document.createElement('img'); m.src=x.image; m.className='slide-image'+(i===0?' active':''); c.appendChild(m); l.innerHTML+=`<div class="flex justify-between bg-black p-2 border border-gray-700 mb-1"><img src="${x.image}" class="h-6 w-10 rounded"><button onclick="deleteSlide('${x.id}')" class="text-red-500 text-xs">DEL</button></div>`; }); if(slideInterval)clearInterval(slideInterval); let idx=0; const im=document.querySelectorAll('.slide-image'); slideInterval=setInterval(()=>{if(im.length){im[idx].classList.remove('active');idx=(idx+1)%im.length;im[idx].classList.add('active');}},5000); }); }
        async function uploadSlide(){ const f=document.getElementById('slideUploadInput').files[0]; const btn = document.getElementById('slideUploadBtn'); if(f){ btn.innerText = "Processing..."; try { const base64 = await compressAndConvertToBase64(f); db.ref('slides').push({image: base64}); showToast('Slide uploaded successfully!'); document.getElementById('slideUploadInput').value = ''; } catch(e) { showToast('Slide upload failed', 'error'); } btn.innerText = "Upload"; } }
        function deleteSlide(id) { showConfirm('Delete Slide?', 'Remove from slideshow?').then((result) => { if (result.isConfirmed) { db.ref('slides/' + id).remove(); showToast('Slide deleted', 'info'); } }); }

        // --- UPDATED NOTIFICATION LOGIC (VERTICAL SCROLL) ---
        function initNotifications() {
            db.ref('system_notifications').limitToLast(20).on('value', (snapshot) => {
                const data = snapshot.val();
                allNotifications = [];
                if (data) {
                    Object.keys(data).forEach(key => allNotifications.push({ id: key, ...data[key] }));
                    // Sort Newest First
                    allNotifications.sort((a, b) => b.timestamp - a.timestamp);
                    // Check red dot based on latest
                    if(allNotifications.length > 0) checkIfSeen(allNotifications[0].timestamp);
                    else hideRedDots();
                } else {
                    hideRedDots();
                }
                renderAdminNotifications();
            });
        }

        function checkIfSeen(timestamp) { 
            const lastSeenTime = localStorage.getItem('apnaAddaLastNotifTime'); 
            if (!lastSeenTime || parseInt(lastSeenTime) < timestamp) showRedDots();
            else hideRedDots();
        }
        function showRedDots() { document.getElementById('desktopNotifDot').classList.remove('hidden'); document.getElementById('mobileNotifDot').classList.remove('hidden'); }
        function hideRedDots() { document.getElementById('desktopNotifDot').classList.add('hidden'); document.getElementById('mobileNotifDot').classList.add('hidden'); }
        
        // Open Modal and Render Vertical List
        function openNotificationModal() { 
            const list = document.getElementById('notificationList');
            list.innerHTML = '';

            if (!allNotifications || allNotifications.length === 0) { 
                list.innerHTML = '<div class="p-8 text-center text-gray-500">No notifications yet.</div>';
                document.getElementById('notificationModal').classList.add('open');
                return; 
            }

            allNotifications.forEach(notif => {
                const dateStr = new Date(notif.timestamp).toLocaleString([], { dateStyle: 'medium', timeStyle: 'short' });
                const imgHtml = notif.image ? `<img src="${notif.image}" class="notif-list-img">` : '';
                const textHtml = notif.text ? `<p class="notif-text-content">${notif.text}</p>` : '';

                const itemHtml = `
                    <div class="notif-item">
                        ${imgHtml}
                        ${textHtml}
                        <div class="notif-date">${dateStr}</div>
                    </div>
                `;
                list.innerHTML += itemHtml;
            });

            // Mark as seen based on the newest item
            if(allNotifications.length > 0) {
                localStorage.setItem('apnaAddaLastNotifTime', allNotifications[0].timestamp);
            }
            
            document.getElementById('notificationModal').classList.add('open'); 
            hideRedDots(); 
        }

        function closeNotificationModal(e) { document.getElementById('notificationModal').classList.remove('open'); }
        
        async function handleNotificationSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('editNotifId').value;
            const text = document.getElementById('notifText').value.trim();
            const file = document.getElementById('notifImage').files[0];
            const btn = document.getElementById('notifSubmitBtn');
            const originalText = btn.innerText;
            if (!text && !file && !id) { showToast('Please add text or an image.', 'warning'); return; }
            let imgUrl = '';
            if (id && !file) { const existing = allNotifications.find(n => n.id === id); if(existing) imgUrl = existing.image || ''; }
            if (file) {
                btn.innerText = "Compressing...";
                try { imgUrl = await compressAndConvertToBase64(file); } catch (err) { showToast('Image processing failed', 'error'); btn.innerText = originalText; return; }
            }
            const payload = { text: text, image: imgUrl, timestamp: Date.now() };
            btn.innerText = "SENDING...";
            let promise;
            if (id) {
                const result = await showConfirm('Update Notification?', 'Users will see the updated version.');
                if(!result.isConfirmed) { btn.innerText = originalText; return; }
                promise = db.ref('system_notifications/' + id).update(payload);
            } else {
                promise = db.ref('system_notifications').push(payload);
            }
            promise.then(() => { showToast(id ? 'Updated successfully!' : 'Notification sent!', 'success'); resetNotifForm(); }).catch(err => { Swal.fire({ icon: 'error', title: 'Sending Failed', text: err.message, background: '#1a1a1a', color: '#fff' }); }).finally(() => { btn.innerText = originalText; });
        }
        
        function renderAdminNotifications() {
            const table = document.getElementById('adminNotifTable'); if(!table) return; table.innerHTML = '';
            allNotifications.forEach(notif => { const truncatedText = notif.text ? (notif.text.length > 30 ? notif.text.substring(0,30) + '...' : notif.text) : 'Image Only'; const dateStr = new Date(notif.timestamp).toLocaleDateString() + ' ' + new Date(notif.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}); table.innerHTML += `<tr class="border-b border-gray-800 hover:bg-gray-800 transition"><td class="p-2"><div class="flex items-center gap-2">${notif.image ? `<img src="${notif.image}" class="w-8 h-8 rounded object-cover border border-gray-600">` : '<div class="w-8 h-8 rounded bg-gray-700 flex items-center justify-center text-xs"><i class="fas fa-comment"></i></div>'}<div class="flex flex-col"><span class="text-white font-bold">${truncatedText}</span><span class="text-[10px] text-gray-500">${dateStr}</span></div></div></td><td class="p-2 text-right"><button onclick="editNotification('${notif.id}')" class="text-blue-400 mr-3 hover:text-white"><i class="fas fa-edit"></i></button><button onclick="deleteNotification('${notif.id}')" class="text-red-500 hover:text-white"><i class="fas fa-trash"></i></button></td></tr>`; });
        }
        function editNotification(id) { const notif = allNotifications.find(n => n.id === id); if (!notif) return; document.getElementById('editNotifId').value = notif.id; document.getElementById('notifText').value = notif.text || ''; document.getElementById('notifSubmitBtn').innerText = "UPDATE"; document.getElementById('notifSubmitBtn').classList.add('bg-yellow-500', 'text-black'); document.getElementById('notifSubmitBtn').classList.remove('bg-white'); showToast('Editing notification...', 'info'); }
        function deleteNotification(id) { showConfirm('Delete Notification?', 'This will verify removing this alert history.').then(res => { if(res.isConfirmed) { db.ref('system_notifications/' + id).remove().then(() => showToast('Notification deleted.', 'info')); } }); }
        function resetNotifForm() { document.getElementById('editNotifId').value = ''; document.getElementById('notifText').value = ''; document.getElementById('notifImage').value = ''; document.getElementById('notifSubmitBtn').innerText = "SEND"; document.getElementById('notifSubmitBtn').classList.remove('bg-yellow-500', 'text-black'); document.getElementById('notifSubmitBtn').classList.add('bg-white'); }
        function renderAdminTable(){ const t=document.getElementById('adminAppsTable');t.innerHTML=''; allApps.forEach(a=>{ t.innerHTML+=`<tr class="border-b border-gray-800"><td class="p-3 text-white">${a.name}</td><td class="p-3 text-xs text-gray-400">${a.status}</td><td class="p-3 text-right"><button onclick="editApp('${a.id}')" class="text-blue-400 mr-2"><i class="fas fa-edit"></i></button><button onclick="deleteApp('${a.id}')" class="text-red-500"><i class="fas fa-trash"></i></button></td></tr>`; }); }

        // --- AUTH & OTHER ---
        function switchAuthTab(mode) {
            const glider = document.getElementById('authGlider'); const loginForm = document.getElementById('loginForm'); const signupForm = document.getElementById('signupForm'); const btnLogin = document.getElementById('tab-login'); const btnSignup = document.getElementById('tab-signup');
            if (mode === 'login') { glider.style.transform = 'translateX(0)'; loginForm.classList.remove('hidden'); signupForm.classList.add('hidden'); btnLogin.classList.add('active'); btnSignup.classList.remove('active'); } 
            else { glider.style.transform = 'translateX(100%)'; loginForm.classList.add('hidden'); signupForm.classList.remove('hidden'); btnLogin.classList.remove('active'); btnSignup.classList.add('active'); }
        }
        auth.onAuthStateChanged((user) => {
            const navLoginBtn = document.getElementById('navLoginBtn'); const navLogoutBtn = document.getElementById('navLogoutBtn'); const navDashBtn = document.getElementById('navDashboardBtn'); const mobileHeaderLoginBtn = document.getElementById('mobileHeaderLoginBtn'); const profileLoggedOut = document.getElementById('profileLoggedOut'); const profileLoggedIn = document.getElementById('profileLoggedIn'); const profileEmail = document.getElementById('profileEmailDisplay'); const profileAdminBtn = document.getElementById('profileAdminBtn');
            if (user) { currentUserEmail = user.email; navLoginBtn.classList.add('hidden'); navLogoutBtn.classList.remove('hidden'); mobileHeaderLoginBtn.classList.add('hidden'); profileLoggedOut.classList.add('hidden'); profileLoggedIn.classList.remove('hidden'); profileEmail.innerText = user.email.split('@')[0]; initUserChat(user.email); if (user.email === ADMIN_EMAIL) { navDashBtn.classList.remove('hidden'); profileAdminBtn.classList.remove('hidden'); fetchSupportChats(); } else { navDashBtn.classList.add('hidden'); profileAdminBtn.classList.add('hidden'); } } 
            else { currentUserEmail = null; navLoginBtn.classList.remove('hidden'); navLogoutBtn.classList.add('hidden'); navDashBtn.classList.add('hidden'); mobileHeaderLoginBtn.classList.remove('hidden'); profileLoggedOut.classList.remove('hidden'); profileLoggedIn.classList.add('hidden'); }
            const savedSection = localStorage.getItem('apnaAddaCurrentSection'); if (user && savedSection === 'login') navigateTo(user.email === ADMIN_EMAIL ? 'admin' : 'home'); if (!user && savedSection === 'admin') navigateTo('login');
        });
        function handleGoogleLogin() { var provider = new firebase.auth.GoogleAuthProvider(); auth.signInWithPopup(provider).then((result) => { if(result.user.email === ADMIN_EMAIL) navigateTo('admin'); else navigateTo('home'); }).catch((error) => { Swal.fire({icon:'error', title:'Error', text:error.message, background:'#111', color:'#fff'}); }); }
        function handleLoginSubmit(e) { e.preventDefault(); const email = document.getElementById('loginEmail').value; const pass = document.getElementById('loginPass').value; const btn = document.getElementById('loginBtn'); const originalText = btn.innerText; btn.innerText = "VERIFYING..."; btn.disabled = true; auth.signInWithEmailAndPassword(email, pass).then((cred) => { if(cred.user.email === ADMIN_EMAIL) navigateTo('admin'); else navigateTo('home'); btn.innerText = originalText; btn.disabled = false; }).catch((error) => { Swal.fire({icon:'error', title:'Login Failed', text:error.message, background:'#111', color:'#fff'}); btn.innerText = originalText; btn.disabled = false; }); }
        function handleSignupSubmit(e) { e.preventDefault(); const email = document.getElementById('signupEmail').value; const pass = document.getElementById('signupPass').value; const btn = document.getElementById('signupBtn'); const originalText = btn.innerText; btn.innerText = "CREATING..."; btn.disabled = true; auth.createUserWithEmailAndPassword(email, pass).then((cred) => { showToast('Account created successfully!'); if(cred.user.email === ADMIN_EMAIL) navigateTo('admin'); else navigateTo('home'); btn.innerText = originalText; btn.disabled = false; }).catch((error) => { Swal.fire({icon:'error', title:'Signup Failed', text:error.message, background:'#111', color:'#fff'}); btn.innerText = originalText; btn.disabled = false; }); }
        function handleLogout() { showConfirm('Logout?', 'Are you sure you want to log out?').then((result) => { if(result.isConfirmed) { localStorage.setItem('apnaAddaCurrentSection', 'home'); auth.signOut().then(() => navigateTo('home')); } }); }
        function sanitizeEmail(email) { return email.replace(/\./g, ','); }
        function toggleChatWindow() { if (!auth.currentUser) { Swal.fire({title:'Authentication Required', text:'Please login to use support chat.', icon:'warning', showCancelButton:true, confirmButtonText:'LOGIN', confirmButtonColor:'#E50914', background:'#111', color:'#fff'}).then((r)=>{if(r.isConfirmed)navigateTo('login');}); return; } const win = document.getElementById('chatWindow'); win.classList.toggle('open'); if(win.classList.contains('open')) { document.getElementById('userChatBadge').classList.add('hidden'); if(currentUserEmail) db.ref(`support_chats/${sanitizeEmail(currentUserEmail)}`).update({ hasUnreadAdmin: false }); } }
        function initUserChat(email) { const chatBody = document.getElementById('userChatBody'); db.ref(`support_chats/${sanitizeEmail(email)}`).limitToLast(50).on('value', snapshot => { const data = snapshot.val(); chatBody.innerHTML = ''; if (data && data.messages) { if (data.hasUnreadAdmin) { if (!document.getElementById('chatWindow').classList.contains('open')) document.getElementById('userChatBadge').classList.remove('hidden'); } Object.values(data.messages).forEach(msg => { const div = document.createElement('div'); div.className = `chat-message ${msg.sender === 'admin' ? 'msg-admin' : 'msg-user'}`; div.innerText = msg.text; chatBody.appendChild(div); }); chatBody.scrollTop = chatBody.scrollHeight; } }); }
        function sendUserMessage(e) { e.preventDefault(); const input = document.getElementById('userChatInput'); const text = input.value.trim(); if (!text || !currentUserEmail) return; const chatRef = db.ref(`support_chats/${sanitizeEmail(currentUserEmail)}`); chatRef.get().then(snap => { const isFirst = !snap.child('messages').exists(); chatRef.child('messages').push({sender:'user', text:text, timestamp:firebase.database.ServerValue.TIMESTAMP}); chatRef.update({userEmail:currentUserEmail, lastMessageTime:firebase.database.ServerValue.TIMESTAMP, hasUnreadUser:true}); input.value = ''; if(isFirst) setTimeout(() => { chatRef.child('messages').push({sender:'admin', text:"ONE TEAM MEMBER WILL SHORTLY ASSISTS YOU!", timestamp:firebase.database.ServerValue.TIMESTAMP}); chatRef.update({hasUnreadAdmin:true}); }, 500); }); }
        function fetchSupportChats() { const list = document.getElementById('adminSupportUserList'); db.ref('support_chats').orderByChild('lastMessageTime').limitToLast(20).on('value', s => { list.innerHTML = ''; const d = s.val(); if(!d) { list.innerHTML='<div class="p-4 text-center text-gray-500">No chats</div>'; return; } Object.entries(d).sort((a,b)=>b[1].lastMessageTime-a[1].lastMessageTime).forEach(([k,v])=>{ const div = document.createElement('div'); div.className=`p-4 border-b border-gray-800 cursor-pointer hover:bg-gray-800 ${currentAdminChatUser===k?'bg-gray-800 border-l-4 border-l-red-600':''}`; div.onclick=()=>openAdminChat(k,v.userEmail); div.innerHTML=`<div class="flex justify-between mb-1"><span class="font-bold text-gray-200 text-sm truncate w-24">${v.userEmail.split('@')[0]}</span><span class="text-xs text-gray-500">${new Date(v.lastMessageTime).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</span></div><div class="text-xs text-gray-400 truncate flex items-center"><i class="fas fa-user-circle mr-1"></i> ${v.userEmail} ${v.hasUnreadUser?'<span class="bg-red-600 w-2 h-2 rounded-full ml-2"></span>':''}</div>`; list.appendChild(div); }); }); }
        function openAdminChat(k,e){ currentAdminChatUser=k; document.getElementById('adminChatHeader').innerHTML=`<span class="text-sm font-bold text-white"><i class="fas fa-user text-red-500 mr-2"></i>${e}</span><button onclick="deleteUserChat()" class="text-red-500 text-xs border border-red-900 px-2 py-1 rounded">DEL</button>`; document.getElementById('adminChatFooter').classList.remove('hidden'); db.ref(`support_chats/${k}`).update({hasUnreadUser:false}); const cb=document.getElementById('adminChatBody'); db.ref(`support_chats/${k}/messages`).limitToLast(50).on('value',s=>{ cb.innerHTML=''; const m=s.val(); if(m)Object.values(m).forEach(x=>{ const d=document.createElement('div'); d.className=`max-w-[80%] p-2 rounded text-xs mb-2 ${x.sender==='admin'?'bg-red-900 text-white self-end':'bg-gray-800 text-gray-300 self-start'}`; d.innerText=x.text; cb.appendChild(d); }); cb.scrollTop=cb.scrollHeight; }); }
        function sendAdminReply(e){ e.preventDefault(); if(!currentAdminChatUser)return; const i=document.getElementById('adminChatInput'); const t=i.value.trim(); if(!t)return; const r=db.ref(`support_chats/${currentAdminChatUser}`); r.child('messages').push({sender:'admin',text:t,timestamp:firebase.database.ServerValue.TIMESTAMP}); r.update({lastMessageTime:firebase.database.ServerValue.TIMESTAMP,hasUnreadAdmin:true}); i.value=''; }
        function deleteUserChat(){ if(!currentAdminChatUser)return; showConfirm('Delete Chat?', 'This cannot be undone.').then(r=>{if(r.isConfirmed)db.ref(`support_chats/${currentAdminChatUser}`).remove().then(()=>{document.getElementById('adminChatBody').innerHTML='';currentAdminChatUser=null;document.getElementById('adminChatFooter').classList.add('hidden');});}); }
        const showToast = (title, icon = 'success') => { Swal.fire({ toast: true, position: 'top-end', icon: icon, title: title, showConfirmButton: false, timer: 3000, timerProgressBar: true, background: '#1a1a1a', color: '#fff', iconColor: '#E50914' }); };
        const showConfirm = (title, text, confirmBtnText = 'Yes, confirm') => { return Swal.fire({ title: title, text: text, icon: 'warning', showCancelButton: true, confirmButtonColor: '#E50914', cancelButtonColor: '#333', confirmButtonText: confirmBtnText, background: '#141414', color: '#fff', iconColor: '#E50914' }); };
    </script>
</body>
</html>
